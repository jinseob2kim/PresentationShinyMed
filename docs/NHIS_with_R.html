<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>R 이용 공공빅데이터 분석 경험</title>
    <meta charset="utf-8" />
    <meta name="author" content="김진섭; <span>&lt;i class="fab  fa-github faa-float animated "&gt;&lt;/i&gt;jinseob2kim</span>" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/font-awesome-animation/font-awesome-animation-emi.css" rel="stylesheet" />
    <script src="libs/fontawesome/js/fontawesome-all.min.js"></script>
    <link href="libs/pagedtable/css/pagedtable.css" rel="stylesheet" />
    <script src="libs/pagedtable/js/pagedtable.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <script src="libs/jszip/jszip.min.js"></script>
    <script src="libs/pdfmake/pdfmake.min.js"></script>
    <script src="libs/pdfmake/vfs_fonts.js"></script>
    <link href="libs/dt-ext-buttons/css/buttons.dataTables.min.css" rel="stylesheet" />
    <script src="libs/dt-ext-buttons/js/dataTables.buttons.min.js"></script>
    <script src="libs/dt-ext-buttons/js/buttons.flash.min.js"></script>
    <script src="libs/dt-ext-buttons/js/buttons.html5.min.js"></script>
    <script src="libs/dt-ext-buttons/js/buttons.colVis.min.js"></script>
    <script src="libs/dt-ext-buttons/js/buttons.print.min.js"></script>
    <link rel="stylesheet" href="css/footer-header.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# R 이용 공공빅데이터 분석 경험
## 을지대학교 학술원 특강
### 김진섭; <a href="https://github.com/jinseob2kim"><span>&lt;i class="fab  fa-github faa-float animated "&gt;&lt;/i&gt;jinseob2kim</span></a>
### 차라투(주)

---





layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;&lt;a href="https://www.zarathu.com"&gt;Zarathu Co.,Ltd&lt;/a&gt;   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&lt;a href="https://github.com/jinseob2kim"&gt;김진섭&lt;/a&gt;&lt;/span&gt;&lt;/div&gt; 


---

# Executive Summary 

.large[
[R](https://www.r-project.org/)로 **심평원, 공단** 빅데이터의 데이터 정리와 통계분석을 수행하였다.
]

--

.large[
* [haven](https://github.com/tidyverse/haven) 패키지로 SAS 파일을 직접 읽을 수 있다.

* [dplyr](https://dplyr.tidyverse.org), [data.table](https://github.com/Rdatatable/data.table) 을 활용, 기존 [R](https://www.r-project.org/) 문법보다 빠르게 데이터 를 정리할 수 있다.  


* [dbplyr](https://dplyr.tidyverse.org) 를 활용, [R](https://www.r-project.org/) 코드를 **PROC SQL** 문으로 바꿔 복잡한 SAS 작업을 수행할 수 있다. 
]

--
.large[
* 자체 개발한 [jsmodule](https://github.com/jinseob2kim/jsmodule) 패키지를 이용, GUI 환경에서 기술통계와 회귀/생존분석을 수행하고 테이블과 그림을 바로 다운받는다.
]

--
.large[ 
[jsmodule](https://github.com/jinseob2kim/jsmodule) 의 [표본조사 데이터 분석](http://app.zarathu.com/survey/) 기능을 활용, GUI 환경에서 **국건영** 데이터 분석을 수행하였다.
]

---
# Why [R](https://www.r-project.org/)?

.large[
**장점** 

- 더 간단한 코드: 특히 **Group by** 작업 

- 테이블, 그림, 반출용 리포트를 바로 만들 수 있다.



**단점**

- Memory 문제: 용량 큰 데이터는 SAS 전처리 필요.

- 공단 명동분석실 환경악화: 램 8gb, 하드 100gb
]


---

class: center, middle

# 데이터 매니지먼트


---
# Read SAS file

[haven](https://haven.tidyverse.org/) 패키지의 `read_sas` 이용


```r
library(haven)
*t20 &lt;- read_sas("t20_example.sas7bdat")  
t20[1:100, ]                            ## Show first 100 rows
```

&lt;div data-pagedtable="false"&gt;
  &lt;script data-pagedtable-source type="application/json"&gt;
{"columns":[{"label":["INDI_DSCM_NO"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["RN_KEY"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["RN_INST"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["MDCARE_STRT_DT"],"name":[4],"type":["chr"],"align":["left"]},{"label":["FORM_CD"],"name":[5],"type":["chr"],"align":["left"]},{"label":["MCARE_SUBJ_CD"],"name":[6],"type":["chr"],"align":["left"]},{"label":["SICK_SYM1"],"name":[7],"type":["chr"],"align":["left"]},{"label":["SICK_SYM2"],"name":[8],"type":["chr"],"align":["left"]},{"label":["HSPTZ_PATH_TYPE"],"name":[9],"type":["chr"],"align":["left"]},{"label":["OFIJ_TYPE"],"name":[10],"type":["chr"],"align":["left"]},{"label":["OPRTN_YN"],"name":[11],"type":["chr"],"align":["left"]},{"label":["MDCARE_DD_CNT"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["VSHSP_DD_CNT"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["TOT_PRSC_DD_CNT"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["MCARE_RSLT_TYPE"],"name":[15],"type":["chr"],"align":["left"]},{"label":["FST_HSPTZ_DT"],"name":[16],"type":["chr"],"align":["left"]},{"label":["EDC_ADD_RT"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["SPCF_SYM_TYPE"],"name":[18],"type":["chr"],"align":["left"]},{"label":["ED_RC_TOT_AMT"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["EDC_SBA"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["EDC_INSUR_BRDN_AMT"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["STD_YYYY"],"name":[22],"type":["chr"],"align":["left"]}],"data":[{"1":"746491","2":"2.002100e+12","3":"47036","4":"20021016","5":"03","6":"14","7":"L218","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"848340","2":"2.002071e+12","3":"47036","4":"20020712","5":"03","6":"14","7":"B351","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"992522","2":"2.002091e+12","3":"70468","4":"20020923","5":"03","6":"10","7":"N_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"543044","2":"2.002090e+12","3":"22970","4":"20020930","5":"03","6":"13","7":"J304","8":"","9":"32","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"928716","2":"2.002080e+12","3":"37742","4":"20020826","5":"03","6":"13","7":"J311","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"633585","2":"2.002050e+12","3":"87180","4":"20020528","5":"03","6":"15","7":"L02","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"706339","2":"2.002041e+12","3":"56719","4":"20020415","5":"03","6":"14","7":"L239","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"515572","2":"2.002071e+12","3":"132199","4":"20020708","5":"03","6":"10","7":"N_","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"71582","2":"2.002070e+12","3":"54811","4":"20020715","5":"03","6":"14","7":"L24","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"701404","2":"2.002070e+12","3":"87406","4":"20020715","5":"03","6":"15","7":"N_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"21","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"364304","2":"2.002080e+12","3":"52291","4":"20020827","5":"03","6":"05","7":"D17","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"746491","2":"2.002080e+12","3":"68608","4":"20020809","5":"03","6":"14","7":"L63","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"1","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"589540","2":"2.002090e+12","3":"57711","4":"20020904","5":"03","6":"10","7":"L088","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"140568","2":"2.002081e+12","3":"56954","4":"20020823","5":"03","6":"10","7":"N_","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"79379","2":"2.002071e+12","3":"61003","4":"20020724","5":"03","6":"13","7":"H603","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"701404","2":"2.002040e+12","3":"87406","4":"20020426","5":"03","6":"15","7":"N_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"21","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"948365","2":"2.002061e+12","3":"96797","4":"20020626","5":"03","6":"01","7":"J06","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"4664","2":"2.002061e+12","3":"123957","4":"20020626","5":"03","6":"10","7":"N_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"603413","2":"2.002090e+12","3":"104975","4":"20020918","5":"03","6":"14","7":"L40","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"6","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"87762","2":"2.002070e+12","3":"24637","4":"20020709","5":"03","6":"05","7":"L23","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"381671","2":"2.002040e+12","3":"68471","4":"20020417","5":"03","6":"13","7":"H603","8":"","9":"32","10":"0","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"915731","2":"2.002040e+12","3":"124688","4":"20020417","5":"03","6":"14","7":"L249","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"592434","2":"2.002071e+12","3":"25054","4":"20020726","5":"03","6":"14","7":"L280","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"616262","2":"2.002051e+12","3":"118989","4":"20020517","5":"03","6":"14","7":"N343","8":"","9":"32","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"91351","2":"2.002050e+12","3":"146000","4":"20020509","5":"03","6":"14","7":"L23","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"410875","2":"2.002040e+12","3":"123579","4":"20020410","5":"03","6":"14","7":"L20","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"7","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"250680","2":"2.002041e+12","3":"83355","4":"20020410","5":"03","6":"13","7":"J029","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"316695","2":"2.002051e+12","3":"109638","4":"20020516","5":"03","6":"10","7":"Z_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"16430","2":"2.002061e+12","3":"57510","4":"20020619","5":"03","6":"10","7":"O_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"7","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"603413","2":"2.002081e+12","3":"104975","4":"20020807","5":"03","6":"14","7":"L40","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"5707","2":"2.002090e+12","3":"92854","4":"20020907","5":"03","6":"14","7":"L748","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"921924","2":"2.002050e+12","3":"86009","4":"20020515","5":"03","6":"15","7":"B354","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"7","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"532859","2":"2.002050e+12","3":"111213","4":"20020515","5":"03","6":"15","7":"N_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"354989","2":"2.002041e+12","3":"72141","4":"20020427","5":"03","6":"10","7":"A_","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"5","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"928716","2":"2.002061e+12","3":"93277","4":"20020612","5":"03","6":"10","7":"N_","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"12","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"364304","2":"2.002061e+12","3":"131235","4":"20020612","5":"03","6":"10","7":"N_","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"951170","2":"2.002070e+12","3":"113252","4":"20020720","5":"03","6":"10","7":"N_","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"51443","2":"2.002061e+12","3":"53295","4":"20020622","5":"03","6":"14","7":"B352","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"1","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"549602","2":"2.002101e+12","3":"31862","4":"20021028","5":"03","6":"10","7":"N_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"541685","2":"2.002101e+12","3":"63916","4":"20021002","5":"03","6":"10","7":"N_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"638825","2":"2.002081e+12","3":"43571","4":"20020803","5":"03","6":"01","7":"J00","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"3000","21":"7590","22":"2002"},{"1":"291910","2":"2.002070e+12","3":"56141","4":"20020727","5":"03","6":"01","7":"J00","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"1500","21":"9090","22":"2002"},{"1":"483473","2":"2.002041e+12","3":"74305","4":"20020425","5":"03","6":"13","7":"H819","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"1","16":"","17":"0.15","18":"","19":"10590","20":"1500","21":"9090","22":"2002"},{"1":"699907","2":"2.002101e+12","3":"2802","4":"20021014","5":"03","6":"14","7":"L029","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"1500","21":"9090","22":"2002"},{"1":"668438","2":"2.002081e+12","3":"104343","4":"20020822","5":"03","6":"14","7":"L503","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"7","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"1500","21":"9090","22":"2002"},{"1":"291910","2":"2.002091e+12","3":"85854","4":"20020928","5":"03","6":"12","7":"H401","8":"","9":"32","10":"0","11":"0","12":"1","13":"1","14":"12","15":"5","16":"","17":"0.15","18":"","19":"10590","20":"1500","21":"9090","22":"2002"},{"1":"5707","2":"2.002090e+12","3":"36485","4":"20020924","5":"03","6":"01","7":"J209","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"530494","2":"2.002090e+12","3":"3571","4":"20020919","5":"03","6":"11","7":"J00","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"880016","2":"2.002090e+12","3":"98672","4":"20020916","5":"03","6":"11","7":"J069","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"137857","2":"2.002070e+12","3":"91748","4":"20020729","5":"03","6":"11","7":"K529","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"481042","2":"2.002051e+12","3":"105434","4":"20020527","5":"03","6":"01","7":"R51","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"767368","2":"2.002051e+12","3":"77924","4":"20020527","5":"03","6":"23","7":"J45","8":"","9":"32","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"767368","2":"2.002091e+12","3":"77924","4":"20020905","5":"03","6":"23","7":"J30","8":"","9":"32","10":"0","11":"0","12":"1","13":"1","14":"5","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"872410","2":"2.002040e+12","3":"14982","4":"20020415","5":"03","6":"01","7":"J060","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"137857","2":"2.002050e+12","3":"91748","4":"20020506","5":"03","6":"13","7":"H660","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"159266","2":"2.002091e+12","3":"143952","4":"20020917","5":"03","6":"11","7":"A09","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"543044","2":"2.002061e+12","3":"93050","4":"20020627","5":"03","6":"01","7":"A05","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"1","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"877959","2":"2.002041e+12","3":"27140","4":"20020419","5":"03","6":"01","7":"K297","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"4","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"637115","2":"2.002070e+12","3":"96949","4":"20020722","5":"03","6":"01","7":"K529","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"370920","2":"2.002060e+12","3":"101271","4":"20020627","5":"03","6":"01","7":"B353","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"1","15":"1","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"358502","2":"2.002071e+12","3":"45002","4":"20020731","5":"03","6":"01","7":"A09","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"637320","2":"2.002051e+12","3":"65938","4":"20020524","5":"03","6":"01","7":"J_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"970780","2":"2.002070e+12","3":"134033","4":"20020726","5":"03","6":"11","7":"K29","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"963070","2":"2.002070e+12","3":"131578","4":"20020724","5":"03","6":"01","7":"J04","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"518558","2":"2.002071e+12","3":"12373","4":"20020719","5":"03","6":"01","7":"J02","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"326639","2":"2.002080e+12","3":"96766","4":"20020808","5":"03","6":"01","7":"B351","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"4","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"716732","2":"2.002100e+12","3":"30220","4":"20021023","5":"03","6":"11","7":"J00","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"781532","2":"2.002061e+12","3":"23126","4":"20020615","5":"03","6":"01","7":"J03","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"974848","2":"2.002080e+12","3":"127347","4":"20020817","5":"03","6":"14","7":"L239","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"51049","2":"2.002100e+12","3":"21314","4":"20021002","5":"03","6":"01","7":"J06","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"760226","2":"2.002011e+12","3":"1319","4":"20020123","5":"03","6":"13","7":"J040","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"441483","2":"2.002100e+12","3":"118418","4":"20021008","5":"03","6":"11","7":"J03","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"3","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"3000","21":"8170","22":"2002"},{"1":"157200","2":"2.002070e+12","3":"89198","4":"20020712","5":"03","6":"01","7":"R100","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"1500","21":"9670","22":"2002"},{"1":"621264","2":"2.002071e+12","3":"90192","4":"20020722","5":"03","6":"01","7":"K26","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"10","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"1500","21":"9670","22":"2002"},{"1":"621264","2":"2.002050e+12","3":"90192","4":"20020506","5":"03","6":"01","7":"K257","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"10","15":"5","16":"","17":"0.15","18":"","19":"11170","20":"1500","21":"9670","22":"2002"},{"1":"876492","2":"2.002060e+12","3":"40649","4":"20020603","5":"03","6":"01","7":"I119","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"30","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"876492","2":"2.002091e+12","3":"40649","4":"20020902","5":"03","6":"01","7":"I119","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"30","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"60216","2":"2.002061e+12","3":"68590","4":"20020611","5":"03","6":"01","7":"E039","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"30","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"797920","2":"2.002061e+12","3":"34236","4":"20020611","5":"03","6":"01","7":"I10","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"28","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"797920","2":"2.002081e+12","3":"34236","4":"20020819","5":"03","6":"01","7":"I10","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"28","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"876492","2":"2.002071e+12","3":"40649","4":"20020702","5":"03","6":"01","7":"I119","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"30","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"252507","2":"2.002070e+12","3":"143497","4":"20020702","5":"03","6":"01","7":"J209","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"2","15":"1","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"763384","2":"2.002061e+12","3":"58488","4":"20020614","5":"03","6":"23","7":"N_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"50","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"797920","2":"2.002041e+12","3":"34236","4":"20020418","5":"03","6":"01","7":"I10","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"28","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"196293","2":"2.002090e+12","3":"119432","4":"20020924","5":"03","6":"01","7":"I10","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"30","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"60216","2":"2.002050e+12","3":"68590","4":"20020517","5":"03","6":"01","7":"E039","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"30","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"303645","2":"2.002071e+12","3":"143926","4":"20020709","5":"03","6":"01","7":"I10","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"364304","2":"2.002051e+12","3":"4542","4":"20020504","5":"03","6":"01","7":"K299","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"7","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"876492","2":"2.002080e+12","3":"40649","4":"20020802","5":"03","6":"01","7":"I119","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"30","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"641955","2":"2.002080e+12","3":"43898","4":"20020802","5":"03","6":"01","7":"B_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"303645","2":"2.002080e+12","3":"143926","4":"20020807","5":"03","6":"01","7":"I10","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"763384","2":"2.002091e+12","3":"7628","4":"20020930","5":"03","6":"01","7":"J_","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"0","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"797920","2":"2.002090e+12","3":"34236","4":"20020913","5":"03","6":"01","7":"I10","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"28","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"183321","2":"2.002050e+12","3":"15568","4":"20020516","5":"03","6":"03","7":"F_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"5","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"334186","2":"2.002041e+12","3":"18263","4":"20020417","5":"03","6":"11","7":"J029","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"60216","2":"2.002070e+12","3":"68590","4":"20020726","5":"03","6":"01","7":"E039","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"30","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"238542","2":"2.002080e+12","3":"29229","4":"20020806","5":"03","6":"01","7":"B_","8":"","9":"","10":"0","11":"0","12":"1","13":"1","14":"28","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"363994","2":"2.002041e+12","3":"107185","4":"20020412","5":"03","6":"01","7":"I10","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"30","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"196293","2":"2.002060e+12","3":"119432","4":"20020619","5":"03","6":"01","7":"I10","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"30","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"},{"1":"530494","2":"2.002101e+12","3":"3571","4":"20021021","5":"03","6":"11","7":"J039","8":"","9":"","10":"","11":"0","12":"1","13":"1","14":"2","15":"5","16":"","17":"0.15","18":"","19":"8160","20":"3000","21":"5160","22":"2002"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  &lt;/script&gt;
&lt;/div&gt;


---
# Read multiple SAS file

공단데이터는 **월별**로 쪼개서 줌. `lapply` 와 `dplyr::bind_row` 로 합친 데이터 만듦

```r
library(dplyr)
## 월별 명세서 데이터
data.t20 &lt;- list.files(pattern = "t20") %&gt;%  ## filename contains "t20"
*  lapply(read_sas) %&gt;% 
*  bind_rows 

## 월별 x-ray 데이터
data.xray &lt;- list.files(pattern = "t30") %&gt;% 
  lapply(function(x){
    read_sas(x) %&gt;% 
    filter(substr(MCARE_DIV_CD_ADJ, 1, 3) == "G21") %&gt;% 
    select(CMN_KEY, MCARE_DIV_CD_ADJ)
    }) %&gt;% 
  bind_rows 
```



---
# Grammar choice

.pull-left[
&lt;center&gt;
&lt;a href="https://dplyr.tidyverse.org/"&gt;&lt;img src="https://github.com/tidyverse/dplyr/raw/master/man/figures/logo.png" width=45%&gt;&lt;/a&gt;
&lt;/center&gt;

- 직관성: `%&gt;%` 연산자, `group_by` 함수  

- `read_sas` 후 바로 적용 가능.

https://blog.zarathu.com/posts/2019-01-03-rdatamanagement/

]

.pull-right[
&lt;center&gt;
&lt;a href="https://rdatatable.gitlab.io/data.table/"&gt;&lt;img src="https://raw.githubusercontent.com/Rdatatable/data.table/master/.graphics/logo.png" width=45%&gt;&lt;/a&gt;
&lt;/center&gt;

- 빠르고 간결한 코드

- Group 변수를 `setkey` 로 미리 설정하면 더 빠름.

- `read_sas` 후 `data.table` 클래스로 바꿔야 함.

https://jinseob2kim.github.io/radv1.html
]


---

# Comparison: 최초 자살시도 


[dplyr](https://dplyr.tidyverse.org/)


```r
out &lt;- t20 %&gt;% 
  filter(substr(SICK_SYM1, 1, 3) %in% paste0("X", 60:84)) %&gt;%  ## X60-84: suicide
  arrange(MDCARE_STRT_DT) %&gt;%
  mutate(YEAR = substr(MDCARE_STRT_DT, 1, 4)) %&gt;%              ## add year variable
  group_by(INDI_DSCM_NO) %&gt;%                                   ## group by individual
  filter(row_number() == 1)                                    ## 1st row
```

[data.table](https://rdatatable.gitlab.io/data.table/)


```r
library(data.table)
t20 &lt;- data.table(t20)
setkey(t20, INDI_DSCM_NO)  ## Fast groupby operation

out &lt;- t20[substr(SICK_SYM1, 1, 3) %in% paste0("X", 60:84)][order(MDCARE_STRT_DT)][, YEAR := substr(MDCARE_STRT_DT, 1, 4)][, .SD[1], by = INDI_DSCM_NO] 
```

---
# [dplyr](https://dplyr.tidyverse.org/) to SQL

[dbplyr](https://dbplyr.tidyverse.org) 패키지로 [dplyr](https://dplyr.tidyverse.org/) 문법을 **SQL** 문으로 바꿀 수 있다.

```r
library(dbplyr)
*t20.db &lt;- tbl_memdb(t20)                               ## DB type data
t20.db %&gt;% 
  filter(substr(SICK_SYM1, 1, 3) %in% paste0("X", 60:84)) %&gt;% 
  arrange(MDCARE_STRT_DT) %&gt;%
  mutate(YEAR = substr(MDCARE_STRT_DT, 1, 4)) %&gt;%       ## Add year variable
  group_by(INDI_DSCM_NO) %&gt;%                            ## group by individual
  filter(row_number() == 1) %&gt;%                         ## 1st row
* show_query                                            ## Show SQL query
```

```sql
SELECT `INDI_DSCM_NO`, `RN_KEY`, `RN_INST`, `MDCARE_STRT_DT`, `FORM_CD`, `MCARE_SUBJ_CD`, `SICK_SYM1`, `SICK_SYM2`, `HSPTZ_PATH_TYPE`, `OFIJ_TYPE`, `OPRTN_YN`, `MDCARE_DD_CNT`, `VSHSP_DD_CNT`, `TOT_PRSC_DD_CNT`, `MCARE_RSLT_TYPE`, `FST_HSPTZ_DT`, `EDC_ADD_RT`, `SPCF_SYM_TYPE`, `ED_RC_TOT_AMT`, `EDC_SBA`, `EDC_INSUR_BRDN_AMT`, `STD_YYYY`, `YEAR`
FROM (SELECT `INDI_DSCM_NO`, `RN_KEY`, `RN_INST`, `MDCARE_STRT_DT`, `FORM_CD`, `MCARE_SUBJ_CD`, `SICK_SYM1`, `SICK_SYM2`, `HSPTZ_PATH_TYPE`, `OFIJ_TYPE`, `OPRTN_YN`, `MDCARE_DD_CNT`, `VSHSP_DD_CNT`, `TOT_PRSC_DD_CNT`, `MCARE_RSLT_TYPE`, `FST_HSPTZ_DT`, `EDC_ADD_RT`, `SPCF_SYM_TYPE`, `ED_RC_TOT_AMT`, `EDC_SBA`, `EDC_INSUR_BRDN_AMT`, `STD_YYYY`, `YEAR`, ROW_NUMBER() OVER (PARTITION BY `INDI_DSCM_NO` ORDER BY `MDCARE_STRT_DT`) AS `zzz3`
      FROM (SELECT `INDI_DSCM_NO`, `RN_KEY`, `RN_INST`, `MDCARE_STRT_DT`, `FORM_CD`, `MCARE_SUBJ_CD`, `SICK_SYM1`, `SICK_SYM2`, `HSPTZ_PATH_TYPE`, `OFIJ_TYPE`, `OPRTN_YN`, `MDCARE_DD_CNT`, `VSHSP_DD_CNT`, `TOT_PRSC_DD_CNT`, `MCARE_RSLT_TYPE`, `FST_HSPTZ_DT`, `EDC_ADD_RT`, `SPCF_SYM_TYPE`, `ED_RC_TOT_AMT`, `EDC_SBA`, `EDC_INSUR_BRDN_AMT`, `STD_YYYY`, SUBSTR(`MDCARE_STRT_DT`, 1, 4) AS `YEAR`
            FROM (SELECT *
                    FROM (SELECT *
                            FROM `t20`
                          WHERE (SUBSTR(`SICK_SYM1`, 1, 3) IN 'X' || (60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84)))
                  ORDER BY `MDCARE_STRT_DT`)))
WHERE (`zzz3` = 1.0)
```

---
# SQL to SAS

생성된 **SQL** 은 바로 SAS **PROC SQL** 문으로 이용 가능.(따옴표는 삭제)

```sql
PROC SQL;
CREATE TABLE out AS
*SELECT INDI_DSCM_NO, RN_KEY, RN_INST, MDCARE_STRT_DT, FORM_CD, MCARE_SUBJ_CD, SICK_SYM1, SICK_SYM2, HSPTZ_PATH_TYPE, OFIJ_TYPE, OPRTN_YN, MDCARE_DD_CNT, VSHSP_DD_CNT, TOT_PRSC_DD_CNT, MCARE_RSLT_TYPE, FST_HSPTZ_DT, EDC_ADD_RT, SPCF_SYM_TYPE, ED_RC_TOT_AMT, EDC_SBA, EDC_INSUR_BRDN_AMT, STD_YYYY, YEAR
*FROM (SELECT INDI_DSCM_NO, RN_KEY, RN_INST, MDCARE_STRT_DT, FORM_CD, MCARE_SUBJ_CD, SICK_SYM1, SICK_SYM2, HSPTZ_PATH_TYPE, OFIJ_TYPE, OPRTN_YN, MDCARE_DD_CNT, VSHSP_DD_CNT, TOT_PRSC_DD_CNT, MCARE_RSLT_TYPE, FST_HSPTZ_DT, EDC_ADD_RT, SPCF_SYM_TYPE, ED_RC_TOT_AMT, EDC_SBA, EDC_INSUR_BRDN_AMT, STD_YYYY, YEAR, ROW_NUMBER() OVER (PARTITION BY INDI_DSCM_NO ORDER BY MDCARE_STRT_DT) AS zzz3
*       FROM (SELECT INDI_DSCM_NO, RN_KEY, RN_INST, MDCARE_STRT_DT, FORM_CD, MCARE_SUBJ_CD, SICK_SYM1, SICK_SYM2, HSPTZ_PATH_TYPE, OFIJ_TYPE, OPRTN_YN, MDCARE_DD_CNT, VSHSP_DD_CNT, TOT_PRSC_DD_CNT, MCARE_RSLT_TYPE, FST_HSPTZ_DT, EDC_ADD_RT, SPCF_SYM_TYPE, ED_RC_TOT_AMT, EDC_SBA, EDC_INSUR_BRDN_AMT, STD_YYYY, SUBSTR(MDCARE_STRT_DT, 1, 4) AS YEAR
*              FROM (SELECT *
*                       FROM (SELECT *
*                                FROM t20
*                              WHERE (SUBSTR(SICK_SYM1, 1, 3) IN 'X' || (60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84)))
*                     ORDER BY MDCARE_STRT_DT)))
*WHERE (zzz3 = 1.0)
QUIT;
```

--
[R](https://www.r-project.org/) 로 직관적인 코드를 만든 후, **PROC SQL** 문으로 바꿔 복잡한 SAS 작업을 수행할 수 있다. 
- 번역 불가능한 [R](https://www.r-project.org/) 함수도 있으므로 주의. 
- 도움말 https://dbplyr.tidyverse.org/articles/sql.html 

---
# Tip: Date 다루기

[lubridate](https://lubridate.tidyverse.org/) 패키지의 `ymd` 함수 추천.

```r
library(lubridate)
t20 %&gt;% 
*  mutate(MDCARE_STRT_DT = ymd(MDCARE_STRT_DT)) %&gt;%  
*  mutate(YEAR = year(MDCARE_STRT_DT)) %&gt;%            ## year: extract year
   select(MDCARE_STRT_DT, YEAR)
```

&lt;div data-pagedtable="false"&gt;
  &lt;script data-pagedtable-source type="application/json"&gt;
{"columns":[{"label":["MDCARE_STRT_DT"],"name":[1],"type":["date"],"align":["right"]},{"label":["YEAR"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"2002-10-16","2":"2002"},{"1":"2002-07-12","2":"2002"},{"1":"2002-09-23","2":"2002"},{"1":"2002-09-30","2":"2002"},{"1":"2002-08-26","2":"2002"},{"1":"2002-05-28","2":"2002"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  &lt;/script&gt;
&lt;/div&gt;


설명서 - https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html


---

class: center, middle

# 통계 분석

---
# R 패키지 개발

3개의 패키지를 [CRAN](https://cran.r-project.org/)에 배포, 공단/심평원 분석실에서 다운 가능.

- [jstable](https://github.com/jinseob2kim/jstable): 논문용 테이블 만들기 

- [jskm](https://github.com/jinseob2kim/jskm): kaplan-meier 생존곡선 그리기

- [jsmodule](https://github.com/jinseob2kim/jsmodule): 위 2 패키지를 적용한 통계분석 웹

--

&lt;center&gt;&lt;a href="https://ipub.com/dev-corner/apps/r-package-downloads/"&gt;&lt;img src="https://raw.githubusercontent.com/jinseob2kim/LectureRpackage/master/docs/RUCK2019/cranstats.png" width=50%&gt;&lt;/a&gt;&lt;/center&gt;


---
# [jstable](https://github.com/jinseob2kim/jstable): table 1

```r
library(jstable)
*tb1 &lt;- CreateTableOneJS(names(mtcars), strata = "vs", data = mtcars, factorVars = c("vs", "am", "gear", "carb"))
datatable(tb1$table[, -6], caption = tb1$caption)
```

<div id="htmlwidget-e1ea36deed4eceb5b3a9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e1ea36deed4eceb5b3a9">{"x":{"filter":"none","caption":"<caption>Stratified by vs<\/caption>","data":[["n","mpg ","cyl ","disp ","hp ","drat ","wt ","qsec ","vs (%)","","am (%)","","gear (%)","","","carb (%)","","","","",""],["","","","","","","","","0","1","0","1","3","4","5","1","2","3","4","6","8"],["    18"," 16.62 (3.86)","  7.44 (1.15)","307.15 (106.77)","189.72 (60.28)","  3.39 (0.47)","  3.69 (0.90)"," 16.69 (1.09)","    18 (100.0) ","     0 (  0.0) ","    12 ( 66.7) ","     6 ( 33.3) ","    12 ( 66.7) ","     2 ( 11.1) ","     4 ( 22.2) ","     0 (  0.0) ","     5 ( 27.8) ","     3 ( 16.7) ","     8 ( 44.4) ","     1 (  5.6) ","     1 (  5.6) "],["    14"," 24.56 (5.38)","  4.57 (0.94)","132.46 (56.89)"," 91.36 (24.42)","  3.86 (0.51)","  2.61 (0.72)"," 19.33 (1.35)","     0 (  0.0) ","    14 (100.0) ","     7 ( 50.0) ","     7 ( 50.0) ","     3 ( 21.4) ","    10 ( 71.4) ","     1 (  7.1) ","     7 ( 50.0) ","     5 ( 35.7) ","     0 (  0.0) ","     2 ( 14.3) ","     0 (  0.0) ","     0 (  0.0) "],["","&lt;0.001","&lt;0.001","&lt;0.001","&lt;0.001"," 0.013"," 0.001","&lt;0.001","&lt;0.001",""," 0.556",""," 0.001","",""," 0.002","","","","",""],["","","","","","","","","","","","","exact","","","exact","","","","",""]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>level<\/th>\n      <th>0<\/th>\n      <th>1<\/th>\n      <th>p<\/th>\n      <th>test<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}],"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
# [jstable](https://github.com/jinseob2kim/jstable): regression

```r
model.logisic &lt;- glm(vs ~ wt + qsec, data = mtcars)
*res.logistic &lt;- glmshow.display(model.logisic)
*out.logistic &lt;- LabelepiDisplay(res.logistic)
datatable(out.logistic, caption = res.logistic$first.line)
```

<div id="htmlwidget-60595dac743c87e7f431" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-60595dac743c87e7f431">{"x":{"filter":"none","caption":"<caption>Linear regression predicting vs\n<\/caption>","data":[["wt","qsec","No. of observations","R-squared","AIC value"],["-0.29 (-0.44,-0.13)","0.21 (0.14,0.28)","32","0.7405","10.7788"],["&lt; 0.001","&lt; 0.001","","",""],["-0.23 (-0.32,-0.13)","0.19 (0.14,0.24)","","",""],["&lt; 0.001","&lt; 0.001","","",""],["**","**",null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>crude coeff.(95%CI)<\/th>\n      <th>crude P value<\/th>\n      <th>adj. coeff.(95%CI)<\/th>\n      <th>adj. P value<\/th>\n      <th>sig<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"rt","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>

---
# [jskm](https://github.com/jinseob2kim/jskm)


```r
library(jskm);library(survival)
fit &lt;- survfit(Surv(time, status) ~ rx, data = colon)
jskm(fit, timeby=365, marks = F, pval = T, table = T)
```

&lt;img src="NHIS_with_R_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /&gt;


---
# [jsmodule](https://github.com/jinseob2kim/jsmodule)

&lt;center&gt;
&lt;figure&gt;
&lt;a href="https://github.com/jinseob2kim/jsmodule"&gt;&lt;img src="https://github.com/jinseob2kim/jsmodule/raw/master/vignettes/figures/addin.gif" width=100%&gt;&lt;/a&gt;
&lt;figurecaption&gt;Rstudio Addins: jsmodule packages&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt;


통계분석 웹 : http://app.zarathu.com/


---
# [jsmodule](https://github.com/jinseob2kim/jsmodule) 특징

**Data type** 따라 분류

- [Basic statistics](http://app.zarathu.com/basic): 기본

- [Repeated measure](http://app.zarathu.com/repeated): 반복측정자료, **GEE** 

- [Survey data](http://app.zarathu.com/survey): 표본조사(**국건영**), **survey regression**

--

**[Propensity score analysis](http://app.zarathu.com/ps)**

- PS 계산 후, **Original/Matching/IPTW** 분석 동시 수행.

--

주요 기능

- 범주형 변수 만들기, reference 바꾸기, Subgroup

- Table 1, 회귀분석, 생존분석, ROC 분석


---

&lt;center&gt;
&lt;figure&gt;
&lt;img src="feature_jsmodule.jpg" width=100%&gt;
&lt;figurecaption&gt;범주형 변수 만들기, reference 바꾸기, Subgroup&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt; 

---
&lt;center&gt;
&lt;figure&gt;
&lt;img src="tb1_jsmodule.jpg" width=100%&gt;
&lt;figurecaption&gt;Table 1&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt; 

---
&lt;center&gt;
&lt;figure&gt;
&lt;img src="cox_jsmodule.jpg" width=100%&gt;
&lt;figurecaption&gt;Cox model&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt; 


---
&lt;center&gt;
&lt;figure&gt;
&lt;img src="km_jsmodule.jpg" width=100%&gt;
&lt;figurecaption&gt;Kaplan-meier plot&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt; 

---
&lt;center&gt;
&lt;figure&gt;
&lt;img src="timeroc_jsmodule.jpg" width=100%&gt;
&lt;figurecaption&gt;Time dependent ROC&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt; 

---
# Table download

<div id="htmlwidget-d8b1732192e75019b2c2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d8b1732192e75019b2c2">{"x":{"filter":"none","extensions":["Buttons"],"caption":"<caption>Linear regression predicting vs\n<\/caption>","data":[["wt","qsec","No. of observations","R-squared","AIC value"],["-0.29 (-0.44,-0.13)","0.21 (0.14,0.28)","32","0.7405","10.7788"],["&lt; 0.001","&lt; 0.001","","",""],["-0.23 (-0.32,-0.13)","0.19 (0.14,0.24)","","",""],["&lt; 0.001","&lt; 0.001","","",""],["**","**",null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>crude coeff.(95%CI)<\/th>\n      <th>crude P value<\/th>\n      <th>adj. coeff.(95%CI)<\/th>\n      <th>adj. P value<\/th>\n      <th>sig<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"rtB","buttons":["copy","print",{"extend":"collection","buttons":[{"extend":"csv","filename":"resLogistic"},{"extend":"excel","filename":"resLogistic"},{"extend":"pdf","filename":"resLogistic"}],"text":"Download"}],"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>

---
# Figure download

`emf` 확장자 지원, **PPT**(2013 이상) 편집 가능.

&lt;center&gt;
&lt;figure&gt;
&lt;img src="https://raw.githubusercontent.com/jinseob2kim/PresentationShinyMed/master/docs/zzz.png" width=100%&gt;
&lt;figurecaption&gt; emf in PPT&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt;



---

class: center, middle

# 국건영 데이터 분석 

---
# 데이터 다운로드

https://knhanes.cdc.go.kr/knhanes/sub03/sub03_02_02.do - **sas, spss** 지원

&lt;center&gt;
&lt;img src="knhanes.jpg" width=100%&gt;
&lt;/center&gt;

---
# 표본조사 가중치

.pull-left[

일반 통계 분석 안됨!! 표본구조 고려한 `svyglm`, `svycox`, `svykm` 필요.

- 가중치 : **wt_ex, wt_ex1, wt_itvex**

- 층화변수: **kstrata, kstrata1, kstratra2**

- 집락변수(1차 표본추출단위): **psu** 
]

.pull-right[
&lt;center&gt;
&lt;figure&gt;
&lt;img src="weight_survey.jpg" width=100%&gt;
&lt;figurecaption&gt; 통합 가중치&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt;
]

---
# [Survey data](http://app.zarathu.com/survey) in [jsmodule](https://github.com/jinseob2kim/jsmodule)


&lt;center&gt;
&lt;figure&gt;
&lt;a href="http://app.zarathu.com/survey"&gt;&lt;img src="https://raw.githubusercontent.com/jinseob2kim/PresentationShinyMed/master/docs/cataract.png" width=100%&gt;&lt;/a&gt;
&lt;figurecaption&gt; 백내장 분석&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt;

---
&lt;center&gt;
&lt;figure&gt;
&lt;img src="untb1_jsmodule.jpg" width=100%&gt;
&lt;figurecaption&gt;Table1: 가중치 미적용&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt; 

---
&lt;center&gt;
&lt;figure&gt;
&lt;img src="wttb1_jsmodule.jpg" width=100%&gt;
&lt;figurecaption&gt;Table1: 가중치 적용&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt; 

---
&lt;center&gt;
&lt;figure&gt;
&lt;img src="svyglm_jsmodule.jpg" width=100%&gt;
&lt;figurecaption&gt;svyglm&lt;/figurecaption&gt;
&lt;/figure&gt;
&lt;/center&gt; 

---

# Executive Summary 

.large[
[R](https://www.r-project.org/)로 **심평원, 공단** 빅데이터의 데이터 정리와 통계분석을 수행하였다.

* [haven](https://github.com/tidyverse/haven) 패키지로 SAS 파일을 직접 읽을 수 있다.

* [dplyr](https://dplyr.tidyverse.org), [data.table](https://github.com/Rdatatable/data.table) 을 활용, 기존 [R](https://www.r-project.org/) 문법보다 빠르게 데이터 를 정리할 수 있다.  

* [dbplyr](https://dplyr.tidyverse.org) 를 활용, [R](https://www.r-project.org/) 코드를 **PROC SQL** 문으로 바꿔 복잡한 SAS 작업을 수행할 수 있다. 

* 자체 개발한 [jsmodule](https://github.com/jinseob2kim/jsmodule) 패키지를 이용, GUI 환경에서 기술통계와 회귀/생존분석을 수행하고 테이블과 그림을 바로 다운받는다.


[jsmodule](https://github.com/jinseob2kim/jsmodule) 의 [표본조사 데이터 분석](http://app.zarathu.com/survey/) 기능을 활용, GUI 환경에서 **국건영** 데이터 분석을 수행하였다.
]


---

class: center, middle

# END
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="js/macros.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "<div class=\"progress-bar-container\">   </div>   <div class=\"progress-bar\" style=\"width: calc(%current% / %total% * 100%);\"> ",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "4:3"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
